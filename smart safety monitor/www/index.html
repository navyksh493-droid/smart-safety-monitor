<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ìŠ¤ë§ˆíŠ¸ ì•ˆì „ ê´€ì œ (Live)</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3a8a">
    <link rel="icon" id="favicon" href="">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; user-select: none; -webkit-tap-highlight-color: transparent; }
        .map-container { height: 100vh; width: 100%; z-index: 10; }
        /* SOS ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .sos-btn { 
            position: absolute; bottom: 80px; right: 20px; z-index: 1000; 
            width: 64px; height: 64px; border-radius: 50%; 
            background: linear-gradient(135deg, #ef4444, #dc2626); 
            color: white; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.6); 
            border: 3px solid white; transition: transform 0.1s;
        }
        .sos-btn:active { transform: scale(0.95); }
        .sos-btn i { font-size: 24px; margin-bottom: 2px; }
        
        /* ë°±ê·¸ë¼ìš´ë“œ ìœ ì§€ìš© ë¹„ë””ì˜¤ (ìˆ¨ê¹€) */
        #no-sleep-video { position: absolute; top: 0; left: 0; width: 1px; height: 1px; opacity: 0; pointer-events: none; }
    </style>
</head>
<body class="bg-gray-100 overflow-hidden h-screen w-screen">

    <video id="no-sleep-video" playsinline muted loop>
        <source src="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAACQm1kYXQAAAGzABAHAAABthADAQAAAB5lbHN0AAAAAAAAAAEAAAABAAAAAAABAAAAAAABAAAAAAOBbW9vdgAAAGxtdmhkAAAAAAAAGNQAABjUAAABAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAh0cmFrAAAAXHRraGQAAAADAAAAGNQAABjUAAAAAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAIAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAABAAAAAAABAAAAAAABAAAAAAOibWRpYQAAACBtZGhkAAAAABjUAAAY1AAAAQAAAQAAAAABAFgAAAAAAAhWhGRscgAAAAAAAAAAbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADWnN0YmwAAAB5c3RzZAAAAAAAAAABAAAAiWF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAQABAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBWQAa//8AAAAuZ2RrdRWbCAoBwQAAA+gA8F2D3awEBAQAAAAEAAAAAAQAAAAEAAAACHN0dHMAAAAAAAAAAQAAAAEAAAB4Y3R0cwAAAAAAAAAAAAABAAEAAAAcY3R0cwAAAAAAAAAAAAABAAEAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN6LmEAAAAAAAAAAQAAAAQAAAA0c3RjbwAAAAAAAAABAAAAAAA=" type="video/mp4">
    </video>

    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-90">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md m-4 relative">
            <div class="text-center mb-8">
                <div class="bg-blue-900 w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-helmet-safety text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">ìŠ¤ë§ˆíŠ¸ ì•ˆì „ ê´€ì œ</h1>
                <p id="conn-status" class="text-xs text-blue-500 mt-2 font-bold animate-pulse">â— ì‹œìŠ¤í…œ ì—°ê²° ì¤‘...</p>
            </div>

            <div class="flex border-b mb-6">
                <button id="tab-login" class="flex-1 py-3 font-bold text-blue-900 border-b-2 border-blue-900">ë¡œê·¸ì¸</button>
                <button id="tab-signup" class="flex-1 py-3 text-gray-400 hover:text-gray-600">íšŒì›ê°€ì…</button>
            </div>

            <div id="form-login" class="space-y-4">
                <input type="text" id="login-id" placeholder="ì•„ì´ë””" class="w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none">
                <div class="relative">
                    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-3 rounded-lg focus:ring-2 focus:ring-blue-900 outline-none">
                    <button id="btn-show-pw" class="absolute right-3 top-3.5 text-gray-400"><i class="fa-solid fa-eye"></i></button>
                </div>
                <div class="flex items-center gap-2 pt-2">
                    <input type="checkbox" id="auto-login-check" class="w-4 h-4 rounded text-blue-900">
                    <label for="auto-login-check" class="text-sm text-gray-600">ìë™ ë¡œê·¸ì¸</label>
                </div>
                <button id="btn-login" class="w-full bg-blue-900 text-white py-4 rounded-lg font-bold shadow-lg hover:bg-blue-800 transition transform active:scale-95">
                    ì ‘ì†í•˜ê¸°
                </button>
            </div>

            <div id="form-signup" class="space-y-4 hidden">
                <input type="text" id="reg-id" placeholder="ì•„ì´ë”” (ì˜ë¬¸/ìˆ«ì)" class="w-full border p-3 rounded-lg">
                <input type="text" id="reg-name" placeholder="ì´ë¦„ (ì‹¤ëª…)" class="w-full border p-3 rounded-lg">
                <input type="password" id="reg-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-3 rounded-lg">
                <div class="border p-2 rounded-lg bg-gray-50">
                    <label class="text-xs font-bold text-gray-500 pl-1">í˜„ì¥ ì„ íƒ</label>
                    <select id="reg-site" class="w-full border p-2 rounded bg-white mt-1">
                        <option value="site1">ê¸°ë³¸ ê±´ì„¤ í˜„ì¥</option>
                    </select>
                </div>
                <select id="reg-role" class="w-full border p-3 rounded-lg bg-white">
                    <option value="worker">ê·¼ë¡œì</option>
                    <option value="admin">í˜„ì¥ì†Œì¥ (ê´€ë¦¬ì)</option>
                    <option value="safety">ì•ˆì „ê´€ë¦¬ì</option>
                </select>
                <button id="btn-signup" class="w-full bg-green-600 text-white py-4 rounded-lg font-bold shadow-lg hover:bg-green-700 transition transform active:scale-95">
                    ê°€ì… ì‹ ì²­
                </button>
            </div>
        </div>
    </div>

    <div id="main-dashboard" class="hidden h-screen flex flex-col">
        <div class="bg-white px-4 py-3 flex justify-between items-center shadow-md z-20">
            <div class="flex items-center gap-2">
                <div class="bg-blue-900 w-8 h-8 rounded flex items-center justify-center text-white"><i class="fa-solid fa-tower-broadcast"></i></div>
                <div>
                    <h1 class="font-bold text-gray-800 text-sm">í†µí•© ê´€ì œì‹¤</h1>
                    <p id="user-display" class="text-[10px] text-gray-500">ì‚¬ìš©ì í™•ì¸ ì¤‘...</p>
                </div>
            </div>
            <button onclick="logout()" class="text-xs bg-gray-100 text-gray-600 px-3 py-2 rounded hover:bg-gray-200 font-bold">
                <i class="fa-solid fa-right-from-bracket mr-1"></i> ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>

        <div class="flex-1 relative bg-gray-200">
            <div id="map" class="h-full w-full outline-none"></div>
            
            <div class="absolute top-4 left-4 right-4 flex justify-center z-[500]">
                <div class="bg-white/90 backdrop-blur px-4 py-2 rounded-full shadow-lg border border-blue-100 flex items-center gap-3">
                    <div class="flex items-center gap-1">
                        <span id="gps-dot" class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></span>
                        <span class="text-xs font-bold text-gray-600">GPS</span>
                    </div>
                    <div class="h-3 w-px bg-gray-300"></div>
                    <span id="gps-acc" class="text-xs text-gray-500 font-mono">ì‹ í˜¸ ëŒ€ê¸°ì¤‘</span>
                </div>
            </div>

            <button onclick="triggerSOS()" class="sos-btn">
                <i class="fa-solid fa-bell"></i>
                SOS
            </button>
        </div>
    </div>

    <script>
        // === 1. ì„¤ì • ë° ì´ˆê¸°í™” ===
        const firebaseConfig = {
            apiKey: "AIzaSyCMWQa-O2m8BB0XHzhXlYfdy3smIsgKs0A",
            authDomain: "smart-safety-monitor-37649.firebaseapp.com",
            projectId: "smart-safety-monitor-37649",
            storageBucket: "smart-safety-monitor-37649.firebasestorage.app",
            messagingSenderId: "409985776476",
            appId: "1:409985776476:web:a36b3b93e734878fb35f99",
            measurementId: "G-E73V9VHXR3"
        };

        let app, auth, db;
        const appId = "default-app-id";
        let map, currentUser = null;
        let markers = {}; 
        let watchId = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('load', () => {
            try {
                app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                
                // ì—°ê²° ìƒíƒœ í‘œì‹œ
                document.getElementById('conn-status').innerText = "â— ì„œë²„ ì—°ê²° ì™„ë£Œ";
                document.getElementById('conn-status').className = "text-xs text-green-600 mt-2 font-bold";
                
                // ìë™ ë¡œê·¸ì¸ í™•ì¸
                const saved = localStorage.getItem('savedUser');
                if(saved) {
                    try { 
                        currentUser = JSON.parse(saved); 
                        startSession(); 
                    } catch(e) { localStorage.removeItem('savedUser'); }
                }

                // í˜„ì¥ ëª©ë¡ ë¡œë“œ
                loadSites();

            } catch (e) {
                document.getElementById('conn-status').innerText = "â— ì—°ê²° ì‹¤íŒ¨: " + e.message;
                document.getElementById('conn-status').className = "text-xs text-red-500 mt-2 font-bold";
            }

            // UI ì´ë²¤íŠ¸ ì—°ê²°
            setupUI();
        });

        function setupUI() {
            // íƒ­ ì „í™˜
            document.getElementById('tab-login').onclick = () => {
                document.getElementById('form-login').classList.remove('hidden');
                document.getElementById('form-signup').classList.add('hidden');
                document.getElementById('tab-login').className = "flex-1 py-3 font-bold text-blue-900 border-b-2 border-blue-900";
                document.getElementById('tab-signup').className = "flex-1 py-3 text-gray-400";
            };
            document.getElementById('tab-signup').onclick = () => {
                document.getElementById('form-login').classList.add('hidden');
                document.getElementById('form-signup').classList.remove('hidden');
                document.getElementById('tab-signup').className = "flex-1 py-3 font-bold text-blue-900 border-b-2 border-blue-900";
                document.getElementById('tab-login').className = "flex-1 py-3 text-gray-400";
            };

            // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°
            document.getElementById('btn-show-pw').onclick = () => {
                const pw = document.getElementById('login-pw');
                pw.type = pw.type === 'password' ? 'text' : 'password';
            };

            document.getElementById('btn-login').onclick = handleLogin;
            document.getElementById('btn-signup').onclick = handleSignup;
        }

        // === 2. ë¡œê·¸ì¸ ë¡œì§ (ê´€ë¦¬ì ìë™ìƒì„± í¬í•¨) ===
        async function handleLogin() {
            const id = document.getElementById('login-id').value;
            const pw = document.getElementById('login-pw').value;
            
            if(!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            try {
                // ìµëª… ì¸ì¦ìœ¼ë¡œ DB ì ‘ê·¼ ê¶Œí•œ ì–»ê¸°
                if (!auth.currentUser) await auth.signInAnonymously();

                // [ìë™ìƒì„±] ìµœê³  ê´€ë¦¬ì ê³„ì •ì´ ì—†ìœ¼ë©´ ë§Œë“¦ (ì²« ë¡œê·¸ì¸ìš©)
                if(id === 'dark584' && pw === 'Rufghs0423!!') {
                    const check = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').where('id', '==', 'dark584').get();
                    if(check.empty) {
                        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').add({
                            id: 'dark584', pw: 'Rufghs0423!!', name: 'ìµœê³  ê´€ë¦¬ì', role: 'super_admin', approved: true, siteId: 'all', createdAt: Date.now()
                        });
                    }
                }

                // ì‚¬ìš©ì ì¡°íšŒ
                const snapshot = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users')
                    .where('id', '==', id).where('pw', '==', pw).get();

                if (snapshot.empty) return alert("ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.");

                const userData = snapshot.docs[0].data();
                userData.docId = snapshot.docs[0].id;

                if (!userData.approved) return alert("ê°€ì… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");

                // ë¡œê·¸ì¸ ì„±ê³µ
                currentUser = userData;
                if(document.getElementById('auto-login-check').checked) {
                    localStorage.setItem('savedUser', JSON.stringify(currentUser));
                }

                startSession();

            } catch (error) {
                alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + error.message);
            }
        }

        async function handleSignup() {
            const id = document.getElementById('reg-id').value;
            const name = document.getElementById('reg-name').value;
            const pw = document.getElementById('reg-pw').value;
            const siteId = document.getElementById('reg-site').value;
            const role = document.getElementById('reg-role').value;

            if(!id || !name || !pw) return alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            try {
                if (!auth.currentUser) await auth.signInAnonymously();
                
                const check = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').where('id', '==', id).get();
                if(!check.empty) return alert("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.");

                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('users').add({
                    id, name, pw, siteId, role, approved: false, createdAt: Date.now()
                });

                alert("ê°€ì… ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nê´€ë¦¬ì ìŠ¹ì¸ í›„ ë¡œê·¸ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                document.getElementById('tab-login').click();
            } catch (error) {
                alert("ê°€ì… ì˜¤ë¥˜: " + error.message);
            }
        }

        // === 3. ë©”ì¸ ê¸°ëŠ¥ (ì§€ë„ & GPS) ===
        function startSession() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-dashboard').classList.remove('hidden');
            document.getElementById('user-display').innerText = `${currentUser.name} (${currentUser.role === 'worker' ? 'ê·¼ë¡œì' : 'ê´€ë¦¬ì'})`;

            // ì§€ë„ ì´ˆê¸°í™” (ë„¤ì´ë²„/ì¹´ì¹´ì˜¤ ëŒ€ì‹  ì˜¤í”ˆìŠ¤íŠ¸ë¦¬íŠ¸ë§µ ì‚¬ìš©)
            if(!map) {
                map = L.map('map', {zoomControl: false}).setView([37.5665, 126.9780], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            }

            // GPS ì‹œì‘ ë° ë°±ê·¸ë¼ìš´ë“œ ìœ ì§€ ì‹œë„
            startGPS();
            
            // ë‹¤ë¥¸ ì‘ì—…ì ìœ„ì¹˜ ì‹¤ì‹œê°„ ìˆ˜ì‹ 
            subscribeWorkers();
        }

        function startGPS() {
            // ë°±ê·¸ë¼ìš´ë“œ ìœ ì§€ë¥¼ ìœ„í•œ ë¹„ë””ì˜¤ ì¬ìƒ
            document.getElementById('no-sleep-video').play().catch(e => console.log("Auto-play blocked"));

            if(navigator.geolocation) {
                const options = { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 };
                
                watchId = navigator.geolocation.watchPosition(
                    (pos) => {
                        const { latitude, longitude, accuracy } = pos.coords;
                        
                        // UI ì—…ë°ì´íŠ¸
                        document.getElementById('gps-dot').classList.remove('bg-gray-400');
                        document.getElementById('gps-dot').classList.add('bg-green-500');
                        document.getElementById('gps-acc').innerText = `ì •í™•ë„ ${Math.round(accuracy)}m`;

                        // ì§€ë„ ì´ë™
                        map.panTo([latitude, longitude]);

                        // ë‚´ ìœ„ì¹˜ ë§ˆì»¤ (íŒŒë€ìƒ‰)
                        if(markers['me']) map.removeLayer(markers['me']);
                        markers['me'] = L.circleMarker([latitude, longitude], {
                            radius: 8, color: '#1e3a8a', fillOpacity: 0.8
                        }).addTo(map).bindPopup("ë‚˜ì˜ ìœ„ì¹˜");

                        // ì„œë²„ ì „ì†¡
                        updateMyPosition(latitude, longitude);
                    },
                    (err) => {
                        document.getElementById('gps-dot').classList.remove('bg-green-500');
                        document.getElementById('gps-dot').classList.add('bg-red-500');
                        document.getElementById('gps-acc').innerText = "ì‹ í˜¸ ì•½í•¨";
                    },
                    options
                );
            }
        }

        async function updateMyPosition(lat, lng) {
            if(!currentUser || !db) return;
            // ë‚´ ìœ„ì¹˜ ì •ë³´ë¥¼ DBì— ë®ì–´ì“°ê¸°
            await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('workers').doc(currentUser.id).set({
                name: currentUser.name,
                role: currentUser.role,
                siteId: currentUser.siteId,
                lat: lat,
                lng: lng,
                lastUpdate: Date.now(),
                isSOS: false // í‰ì†Œì—” false
            }, { merge: true });
        }

        function subscribeWorkers() {
            if (!db) return;
            // ë‹¤ë¥¸ ì‚¬ëŒë“¤ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
            let query = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('workers');
            
            // í˜„ì¥ì´ ê°™ìœ¼ë©´ ë‹¤ ë³´ì—¬ì£¼ê¸°
            if(currentUser.siteId !== 'all') {
                query = query.where('siteId', '==', currentUser.siteId);
            }

            query.onSnapshot((snapshot) => {
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if(data.id === currentUser.id) return; // ë‚´êº¼ëŠ” ì œì™¸

                    // 5ë¶„ ì´ìƒ ì—…ë°ì´íŠ¸ ì—†ìœ¼ë©´ ì§€ë„ì—ì„œ ì œê±°
                    if(Date.now() - data.lastUpdate > 300000) {
                        if(markers[doc.id]) map.removeLayer(markers[doc.id]);
                        return;
                    }

                    // ë§ˆì»¤ í‘œì‹œ
                    if(markers[doc.id]) map.removeLayer(markers[doc.id]);
                    
                    const color = data.isSOS ? '#ef4444' : '#3b82f6'; // SOSë©´ ë¹¨ê°„ìƒ‰
                    const radius = data.isSOS ? 15 : 6;

                    const marker = L.circleMarker([data.lat, data.lng], {
                        radius: radius, color: color, fillColor: color, fillOpacity: 0.7
                    }).addTo(map).bindPopup(`<b>${data.name}</b><br>${data.role}`);
                    
                    markers[doc.id] = marker;

                    // SOS ë°œìƒ ì‹œ ì•Œë¦¼ì°½ ë„ìš°ê¸° (ê´€ë¦¬ìë§Œ)
                    if(data.isSOS && currentUser.role !== 'worker') {
                        alert(`ğŸš¨ êµ¬ì¡° ìš”ì²­ ë°œìƒ!\nì´ë¦„: ${data.name}\nìœ„ì¹˜ í™•ì¸ ìš”ë§`);
                    }
                });
            });
        }

        function loadSites() {
            try {
                if (!auth.currentUser) auth.signInAnonymously();
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection('sites').onSnapshot(snap => {
                    const sel = document.getElementById('reg-site');
                    sel.innerHTML = '';
                    snap.forEach(doc => {
                        sel.innerHTML += `<option value="${doc.id}">${doc.data().name}</option>`;
                    });
                    if(sel.innerHTML === '') sel.innerHTML = '<option value="default">ê¸°ë³¸ ê±´ì„¤ í˜„ì¥</option>';
                });
            } catch(e) {}
        }

        window.logout = function() {
            localStorage.removeItem('savedUser');
            location.reload();
        };

        window.triggerSOS = function() {
            if(currentUser && db) {
                if(confirm("ğŸš¨ ê¸´ê¸‰ êµ¬ì¡° ìš”ì²­ì„ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    db.collection('artifacts').doc(appId).collection('public').doc('data').collection('workers').doc(currentUser.id).set({
                        isSOS: true,
                        lastUpdate: Date.now()
                    }, { merge: true });
                    alert("êµ¬ì¡° ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì£¼ë³€ ê´€ë¦¬ìì—ê²Œ ì•Œë¦¼ì´ ê°‘ë‹ˆë‹¤.");
                }
            }
        };
    </script>
</body>
</html>